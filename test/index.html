<script src="../dist/linq.js"></script>
<script src="../dist/svg.js"></script>

<script src="../dist/netcdf.js"></script>
<script src="../dist/ms-imaging.js"></script>

<style>
    #canvas {
        border: #909090 1px solid;
        background: #fff;
        color: #333;
        filter: progid:DXImageTransform.Microsoft.Shadow(color=#909090, direction=120, strength=4);
        -moz-box-shadow: 2px 2px 10px #909090;
        -webkit-box-shadow: 2px 2px 10px #909090;
        box-shadow: 4px 9px 20px 5px #909090
    }
</style>

<div id="canvas"></div>

<script>
    loadNetCDF("./HR2MSI mouse urinary bladder S096 - Figure1.cdf", function (MSI) {
        console.log(MSI);

        const opts = RenderOptions(0.5, [6, 6], Jet, "#canvas",
            function (pixel) {
                $ts("#MS").clear();

                if (!(pixel.mz)) {
                    $ts("#MS").display("no data at pixel: [" + pixel.x + ", " + pixel.y + "]");
                } else {
                    const MS = pixel.mz.map(function (mzi, i) { return { mz: mzi, intensity: pixel.intensity[i] } });

                    $ts("#MS").display("<code>" + JSON.stringify(pixel) + "</code>");
                    $ts.appendTable(MS, "#MS");
                }

            });

        MSI.renderRGB(741.43, 743.5, 798.4, opts);

        const selectMz = document.getElementById("mz");

        for (var i = 0; i < MSI.mz.length; i++) {
            selectMz.appendChild($ts("<option>", { value: MSI.mz[i] }).display(MSI.mz[i]));
        }

        $ts("#mz").onchange = function () {
            const mz = $ts.value("#mz")[0];

            console.log("select m/z:");
            console.log(mz);

            MSI.renderMz(mz, opts);
        }

        $ts("#png").onclick = function () {
            let svg = document.getElementById("canvas").childNodes.item(0);

            CanvasHelper.saveSvgAsPng.Encoder.saveSvgAsPng(svg, "MSI");
        }
    });
</script>

<div>

    select a m/z layer:

    <select id="mz">

    </select>

</div>

<a href="#" id="png">Download png</a>

<div id="MS">


</div>